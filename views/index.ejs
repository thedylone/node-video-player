<!doctype html>

[%- include('partials/head', {title: 'main'}); -%]

<body spellcheck="false">
  [%- include('partials/header', {search: search}); -%]
  <div class="sidebar">
    <div class="sidebar__filterwrapper">
      [% if (data) for (var source of [...new Set(Object.values(data).map(x=> x.source))]) { %]
      <label class="sidebar__filter__list--item" onclick="filterSource()">
        <input type="checkbox" name="filter" value="[%= source %]" [% if (filter && filter.includes(source)) { %] checked [% } %]>
        <span class="sidebar__filter__list--check"></span>
        [%= source %]
      </label>
      [% } %]
    </div>
  </div>
  <div class="contents-container">
    [% let count = 0; if (data) { for (var id in data) {
      if (
        (!filter || filter.includes(data[id].source)) && 
        (!search || id.toLowerCase().includes(search.toLowerCase()) || data[id].tags.join().toLowerCase().includes(search.toLowerCase()) )) { count++; %]
    <div class="video-container">
      <a class="video-container__thumbnail" href="[%= encodeURI('/watch?id='+id) %]">
        <video class="video-container__thumbnail--video" muted preload="none" data-path="[%= id %]" onmouseenter="showPreview($(this))" onmouseleave="stopPreview($(this))"></video>
      </a>
      <a class="video-container__title" href="[%= encodeURI('/watch?id='+id) %]">
        [%= data[id].title %]
      </a>
      <div class="video-container__subtitle">
        <div class="video-container__subtitle--source">
          [%= data[id].source %]
        </div>
        <div class="video-container__subtitle--counter">
          [%= data[id].counter %]
        </div>
      </div>
      <div class="video-container__tags">
        tags:
        [% for (var tag of data[id].tags) { %]
        <button class="video-container__tags--tag">
          [%= tag %]
        </button>
        [% } %]
      </div>
    </div>
    [% } } } %]
    [% if (count == 0) { %]
      <div class="video-container--empty">
        No results found
      </div>
    [% } %]
  </div>
  [%- include('partials/popups'); -%]
</body>
<script>
</script>

</html>